MEGA FIX PROMPT - Execute All Fixes
You are a senior full-stack developer fixing critical bugs in the Gatwick Bank fintech platform. Fix ALL the following issues in ONE session:

1. Date Formatting Bug (HIGH PRIORITY)
Location: All transaction displays showing "Invalid Date" Files to Fix:

Create frontend/src/utils/dateFormatter.js:
javascript
export const formatDate = (date) => {
  if (!date) return 'N/A';
  const d = new Date(date);
  if (isNaN(d.getTime())) return 'Invalid Date';
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

export const formatDateTime = (date) => {
  if (!date) return 'N/A';
  const d = new Date(date);
  if (isNaN(d.getTime())) return 'Invalid Date';
  return d.toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
};
Update all components using dates: DashboardPage.jsx, TransactionHistory.jsx, CardsPage.jsx
2. Card Holder Name Fix (CRITICAL)
Location: backend/src/services/cardService.js and card creation logic Fix: Replace "GATWICK BANK" with user's full name from database

javascript
cardHolderName: `${user.firstName} ${user.lastName}`.toUpperCase()
3. Card Number Format Fix (CRITICAL)
Location: frontend/src/pages/CardsPage.jsx Current: Shows base64 encoded "Nw==" Fix: Decode card number and format as "5175 •••• •••• ####"

javascript
const formatCardNumber = (encryptedNumber) => {
  try {
    const decoded = atob(encryptedNumber);
    const lastFour = decoded.slice(-4);
    return `5175 •••• •••• ${lastFour}`;
  } catch {
    return '•••• •••• •••• ••••';
  }
};
4. Card Reveal Button with Backup Code (HIGH)
Location: frontend/src/pages/CardsPage.jsx Add:

Reveal button next to card number
Modal requiring backup code verification
Show full card details (number, CVV, expiry) after verification
javascript
<button onClick={() => setShowRevealModal(true)}>
  <Eye className="w-4 h-4" /> Reveal
</button>
5. Fix Card Details API 404 (CRITICAL)
Location: backend/src/services/cardService.js:123 Issue: Query failing to find cards Fix: Update the query to properly join debit_cards and credit_cards tables:

javascript
export const getCardById = async (cardId, userId) => {
  // Try debit cards first
  const debitCard = await prisma.debitCard.findFirst({
    where: { id: cardId, userId },
    include: { account: true }
  });
  
  if (debitCard) return { success: true, card: debitCard, type: 'debit' };
  
  // Try credit cards
  const creditCard = await prisma.creditCard.findFirst({
    where: { id: cardId, userId }
  });
  
  if (creditCard) return { success: true, card: creditCard, type: 'credit' };
  
  throw new Error('Card not found or unauthorized');
};
6. Add Avatar Upload Feature (MEDIUM)
Location: frontend/src/pages/AccountSettings.jsx Add: Profile picture upload section

jsx
<div className="mb-6">
  <label className="block text-sm font-medium mb-2">Profile Picture</label>
  <input type="file" accept="image/*" onChange={handleAvatarUpload} />
  {avatarPreview && <img src={avatarPreview} className="w-24 h-24 rounded-full mt-2" />}
</div>
Backend: Add /api/v1/users/avatar endpoint with multer upload

7. Payment Gateway Integration - Deposits (CRITICAL)
Location: frontend/src/pages/DepositPage.jsx Add: Gateway selection dropdown before amount input

jsx
<div className="mb-4">
  <label>Select Payment Gateway *</label>
  <select value={selectedGateway} onChange={(e) => setSelectedGateway(e.target.value)}>
    <option value="">Choose gateway...</option>
    {gateways.map(g => (
      <option key={g.id} value={g.id}>{g.name} - {g.type}</option>
    ))}
  </select>
</div>
Add: Payment proof upload, QR code display for crypto, admin approval workflow

8. Create Missing Deposits API Endpoint (CRITICAL)
Location: backend/src/routes/mybanker.js Add:

javascript
router.get('/deposits', verifyAuth, isAdmin, async (req, res) => {
  try {
    const { status } = req.query;
    const where = status === 'all' ? {} : { status: status.toUpperCase() };
    
    const deposits = await prisma.deposit.findMany({
      where,
      include: {
        user: { select: { firstName: true, lastName: true, email: true } },
        account: { select: { accountNumber: true } },
        gateway: { select: { name: true, type: true } }
      },
      orderBy: { createdAt: 'desc' }
    });
    
    res.json({ success: true, deposits });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
9. Fix Frontend Deployment Path (DEPLOYMENT)
Location: backend/src/index.js Issue: /frontend/dist/index.html not found Fix: Update static file serving path:

javascript
// Serve frontend in production
if (process.env.NODE_ENV === 'production') {
  app.use(express.static(path.join(__dirname, '../../frontend/dist')));
  app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../../frontend/dist/index.html'));
  });
}
10. Fix Admin Card Endpoint 403 (MEDIUM)
Location: backend/src/routes/adminCards.js Fix: Ensure admin middleware is properly applied:

javascript
router.get('/credit/pending', verifyAuth, isAdmin, async (req, res) => {
  try {
    const pending = await prisma.creditCard.findMany({
      where: { approvalStatus: 'PENDING' },
      include: {
        user: {
          select: { id: true, email: true, firstName: true, lastName: true, kycStatus: true }
        }
      },
      orderBy: { createdAt: 'asc' }
    });
    
    res.json({ success: true, count: pending.length, applications: pending });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
11. Withdrawal Page with Gateway Selection (HIGH)
Location: Create frontend/src/pages/WithdrawalPage.jsx Include: Same gateway selection as deposits, admin approval workflow

12. International Transfers with Admin Approval (HIGH)
Verify: backend/src/services/transferService.js properly creates transfer requests Add: Admin notification system for pending transfers

EXECUTION ORDER
Backend Fixes First (30 min):
Fix card service queries (#5)
Create deposits API endpoint (#8)
Fix admin card endpoint (#10)
Update static file serving (#9)
Frontend Core Fixes (45 min):
Create date formatter utility (#1)
Fix card number formatting (#3)
Fix card holder name display (#2)
Add card reveal button (#4)
Payment Gateway Integration (1 hour):
Add gateway selection to deposits (#7)
Create withdrawal page with gateways (#11)
Implement admin approval workflow
Enhancement Features (30 min):
Add avatar upload (#6)
Test international transfers (#12)



use foward thinking to determine forward logic to each next step,, determine buttons, modals, events, EventCounts 